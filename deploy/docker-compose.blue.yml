# Blue slot for YuhHearDem blue-green deployment
# Web service on port 8003

services:
  web-blue:
    image: ghcr.io/hammertoe/yuhheardem:${IMAGE_TAG:-latest}
    container_name: yhd-web-blue
    restart: unless-stopped
    environment:
      DATABASE_URL: ${DATABASE_URL}
      GOOGLE_API_KEY: ${GOOGLE_API_KEY}
      APP_ENV: production
      DEBUG: "False"
      CORS_ORIGINS: ${CORS_ORIGINS:-["https://yuhheardem.com"]}
    volumes:
      - /var/lib/yuhheardem/storage:/app/storage
      - /var/lib/yuhheardem/processed:/app/processed
    ports:
      - "127.0.0.1:8003:8000"
    networks:
      - yhd-blue
      - yhd-shared
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s

networks:
  yhd-blue:
    driver: bridge
  yhd-shared:
    external: true
